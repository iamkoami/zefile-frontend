(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[284],{1880:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f});var r=s(5155),a=s(2115),o=s(5695),n=s(8126),l=s.n(n),i=s(6874),d=s.n(i),c=s(5499);class u{async uploadFile(e,t,s,r,a){let o=new FormData;return o.append("file",e),o.append("transferShortCode",t),o.append("uploadedBy",s),o.append("transferId",r),c.u.upload("/storage/upload",o,a)}async getDownloadUrl(e){return c.u.post("/storage/download/url",e)}async getZipDownloadUrl(e){return c.u.post("/storage/download/zip",e)}async getTransferInfo(e,t){let s="/storage/info/".concat(e);return t?c.u.post(s,{password:t}):c.u.get(s)}async verifyCertificate(e){return c.u.post("/storage/verify-certificate",{certificateId:e})}async deleteTransfer(e){return c.u.delete("/storage/transfer/".concat(e))}async getCertificate(e){return c.u.get("/storage/certificate/".concat(e))}async downloadFile(e,t){try{let s=await fetch(e),r=await s.blob(),a=window.URL.createObjectURL(r),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(a)}catch(e){throw console.error("Download failed:",e),e}}getShortLinkUrl(e){let t="localhost:3001",s=t.includes("localhost")?"http":"https";return"".concat(s,"://").concat(t,"/t/").concat(e)}}let m=new u;class h{async execute(e){let{shortCode:t,password:s}=e,r=await m.getTransferInfo(t,s);if(r.error)throw Error(r.error.message||"Failed to fetch transfer information");if(!r.data)throw Error("No transfer data received");return{id:r.data.id,shortCode:r.data.shortCode,recipientEmail:r.data.recipientEmail,senderEmail:r.data.senderEmail,message:r.data.message,expiryDate:r.data.expiryDate,downloadCount:r.data.downloadCount,maxDownloads:r.data.maxDownloads,files:r.data.files,hasPassword:r.data.hasPassword,status:r.data.status}}}let x=new h;function g(e){let{transfer:t,trackingParams:s,passwordRequired:o,onPasswordSubmit:n,error:l}=e,[i,d]=(0,a.useState)(""),[c,u]=(0,a.useState)(!1),h=async e=>{if(t)try{var s;u(!0);let r=await m.getDownloadUrl({shortCode:t.shortCode,fileIds:e?[e]:void 0,password:i||void 0});if(r.error)return void alert(r.error.message||"Failed to generate download link");if(null==(s=r.data)?void 0:s.urls)for(let e of r.data.urls)window.open(e.url,"_blank")}catch(e){console.error("Download error:",e),alert(e.message||"Failed to download files")}finally{u(!1)}},x=async()=>{if(t)try{var e;u(!0);let s=await m.getZipDownloadUrl({shortCode:t.shortCode,password:i||void 0});if(s.error)return void alert(s.error.message||"Failed to generate ZIP download");(null==(e=s.data)?void 0:e.zipUrl)&&window.open(s.data.zipUrl,"_blank")}catch(e){console.error("ZIP download error:",e),alert(e.message||"Failed to download ZIP")}finally{u(!1)}},g=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]};if(o&&!t)return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,r.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("svg",{className:"w-16 h-16 text-blue-600 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Password Protected"}),(0,r.jsx)("p",{className:"text-gray-600",children:"This transfer requires a password to access"}),l&&(0,r.jsx)("p",{className:"text-red-600 mt-2 text-sm",children:l})]}),(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i.trim()&&n(i)},children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter Password"}),(0,r.jsx)("input",{type:"password",id:"password",value:i,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter password",required:!0})]}),(0,r.jsx)("button",{type:"submit",className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Unlock Transfer"})]})]})});if(!t)return null;let p=t.files.reduce((e,t)=>e+t.size,0);return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8 mb-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)("svg",{className:"w-20 h-20 text-blue-600 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Files Ready for Download"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["From: ",(0,r.jsx)("span",{className:"font-medium",children:t.senderEmail})]})]}),t.message&&(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,r.jsx)("p",{className:"text-blue-900",children:t.message})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center",children:[(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Files"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.files.length})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Total Size"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:g(p)})]}),(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Expires"}),(0,r.jsx)("p",{className:"text-lg font-bold text-gray-900",children:new Date(t.expiryDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),(0,r.jsxs)("button",{onClick:x,disabled:c,className:"w-full px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),c?"Preparing Download...":"Download All as ZIP"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["Files (",t.files.length,")"]}),(0,r.jsx)("div",{className:"space-y-3",children:t.files.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,r.jsx)("svg",{className:"w-10 h-10 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 truncate",children:e.filename}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:g(e.size)})]})]}),(0,r.jsxs)("button",{onClick:()=>h(e.id),disabled:c,className:"px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed flex items-center gap-2 flex-shrink-0",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]},e.id))})]}),(0,r.jsxs)("div",{className:"text-center mt-8 text-sm text-gray-500",children:[(0,r.jsxs)("p",{children:["Short code: ",t.shortCode]}),t.maxDownloads&&(0,r.jsxs)("p",{className:"mt-1",children:["Downloads: ",t.downloadCount," / ",t.maxDownloads]}),s.z_sid&&(0,r.jsxs)("p",{className:"mt-1 text-xs",children:["Session ID: ",s.z_sid]})]})]})})}function p(){let e=(0,o.useSearchParams)(),[t,s]=(0,a.useState)(null),[n,i]=(0,a.useState)({}),[c,u]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),[p,f]=(0,a.useState)(!1),[b,w]=(0,a.useState)("");(0,a.useEffect)(()=>{let t=null==e?void 0:e.get("code"),s=window.location.pathname.split("/"),r=s.length>2?s[2]:null,a=t||r;if(!a){h("Invalid transfer link"),u(!1);return}i({z_exp:(null==e?void 0:e.get("z_exp"))||void 0,z_sid:(null==e?void 0:e.get("z_sid"))||void 0,z_src:(null==e?void 0:e.get("z_src"))||"link",z_network:(null==e?void 0:e.get("z_network"))||void 0,z_ts:(null==e?void 0:e.get("z_ts"))||Date.now().toString()}),v(a)},[e]);let v=async(e,t)=>{try{u(!0),h(null);let r=await x.execute({shortCode:e,password:t||b||void 0});s(r),f(!1)}catch(e){var r,a,o,n;console.error("Error fetching transfer:",e),(null==(r=e.message)?void 0:r.includes("password"))||(null==(a=e.message)?void 0:a.includes("401"))?(f(!0),h("This transfer is password protected")):(null==(o=e.message)?void 0:o.includes("404"))||(null==(n=e.message)?void 0:n.includes("not found"))?h("Transfer not found or expired"):h(e.message||"Failed to load transfer")}finally{u(!1)}};return c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l(),{children:[(0,r.jsx)("meta",{name:"robots",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("meta",{name:"googlebot",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("title",{children:"Loading Transfer - ZeFile"})]}),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading transfer..."})]})})]}):m&&!p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l(),{children:[(0,r.jsx)("meta",{name:"robots",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("meta",{name:"googlebot",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("title",{children:"Transfer Not Available - ZeFile"})]}),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[(0,r.jsx)("svg",{className:"w-16 h-16 text-red-500 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Transfer Not Available"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:m}),(0,r.jsx)(d(),{href:"/",className:"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Go to Homepage"})]})})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l(),{children:[(0,r.jsx)("meta",{name:"robots",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("meta",{name:"googlebot",content:"noindex, nofollow, noarchive, nosnippet"}),(0,r.jsx)("title",{children:"Download Files - ZeFile"})]}),(0,r.jsx)(g,{transfer:t,trackingParams:n,passwordRequired:p,onPasswordSubmit:t=>{w(t);let s=null==e?void 0:e.get("code"),r=window.location.pathname.split("/"),a=r.length>2?r[2]:null;v(s||a||"",t)},error:m})]})}function f(){return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading transfer..."})]})}),children:(0,r.jsx)(p,{})})}},5499:(e,t,s)=>{"use strict";s.d(t,{u:()=>a});class r{setAccessToken(e){this.accessToken=e,e?localStorage.setItem("access_token",e):localStorage.removeItem("access_token")}getAccessToken(){return this.accessToken?this.accessToken:localStorage.getItem("access_token")}async request(e,t,s){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a="".concat(this.baseURL).concat(t),o=this.getAccessToken(),n={"Content-Type":"application/json",...r.headers};o&&(n.Authorization="Bearer ".concat(o));let l=new AbortController,i=setTimeout(()=>l.abort(),this.timeout);try{let t=await fetch(a,{method:e,headers:n,body:s?JSON.stringify(s):void 0,signal:l.signal,...r});clearTimeout(i);let o=await t.json().catch(()=>null);if(!t.ok)return{error:{message:(null==o?void 0:o.message)||"An error occurred",statusCode:t.status,error:null==o?void 0:o.error},status:t.status};return{data:o,status:t.status}}catch(e){if(clearTimeout(i),"AbortError"===e.name)return{error:{message:"Request timeout",statusCode:408},status:408};return{error:{message:e.message||"Network error",statusCode:0},status:0}}}async get(e,t){return this.request("GET",e,void 0,t)}async post(e,t,s){return this.request("POST",e,t,s)}async patch(e,t,s){return this.request("PATCH",e,t,s)}async delete(e,t){return this.request("DELETE",e,void 0,t)}async upload(e,t,s){let r="".concat(this.baseURL).concat(e),a=this.getAccessToken();return new Promise(e=>{let o=new XMLHttpRequest;s&&o.upload.addEventListener("progress",e=>{e.lengthComputable&&s(e.loaded/e.total*100)}),o.addEventListener("load",()=>{try{let t=JSON.parse(o.responseText);o.status>=200&&o.status<300?e({data:t,status:o.status}):e({error:{message:(null==t?void 0:t.message)||"Upload failed",statusCode:o.status,error:null==t?void 0:t.error},status:o.status})}catch(t){e({error:{message:"Failed to parse response",statusCode:o.status},status:o.status})}}),o.addEventListener("error",()=>{e({error:{message:"Network error",statusCode:0},status:0})}),o.addEventListener("timeout",()=>{e({error:{message:"Request timeout",statusCode:408},status:408})}),o.open("POST",r),o.timeout=this.timeout,a&&o.setRequestHeader("Authorization","Bearer ".concat(a)),o.send(t)})}constructor(){this.accessToken=null,this.baseURL="http://localhost:3001",this.timeout=parseInt("30000")}}let a=new r},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},8012:(e,t,s)=>{Promise.resolve().then(s.bind(s,1880))},8126:(e,t)=>{"use strict";function s(){return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{var t=t=>e(e.s=t);e.O(0,[874,441,684,358],()=>t(8012)),_N_E=e.O()}]);